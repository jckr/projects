<html><head>
<script type="text/javascript" src="http://blog.oecdfactblog.org/wp-includes/js/protovis-r3.2.js"></script>
<style>
#ruler { visibility: hidden; white-space: nowrap; }
.c0{background-color:#0078ba;}
.c9{background-color:#b2b2b2;}
.c1{background-color:#af418e;}
.c8{background-color:#97bf0d;}
.c6{background-color:#ed4e70;}
.c3{background-color:#ffdd00;}
.c2{background-color:#e5352d;}
.c4{background-color:#009036;}
.c7{background-color:#e15c12;}
.c5{background-color:#009ee0;}

.c0,.c1,.c2,.c3,.c4,.c5,.c6,.c7,.c8, .c9{width:30px;height:20px;float:left;}
#formDiv {position:relative;}
#col1, #col2 {position:absolute; top:0px;width:500px;}
#col1 {left:0px:}
#col2 {left:505px;}
body{background:#ccc;font:10px verdana;}
td {font:10px verdana;}
h1,h2,h3,h3,h5,h5, {font-family:georgia;}
.tSpan {font: 14px Georgia bold;}

#formDiv {width: 1005px;}
#dataDiv, #titleDiv, #marginsDiv {width: 500px;}
#formDiv,#col1,#col2{position:static;width:500px;}
#chart {position:absolute;top:20px;left:550px;}
#result {position:absolute;top:450px;left:550px;}
#svg {position:absolute;top:500px;left:550px;}
}

</style>
<script type="text/javascript">

	//    http://www.JSON.org/json2.js

	//    2009-06-29

	//    Minified

	var JSON=JSON||{};(function(){function f(n){return n<10?'0'+n:n;}if(typeof Date.prototype.toJSON!=='function'){Date.prototype.toJSON=function(key){return isFinite(this.valueOf())?this.getUTCFullYear()+'-'+f(this.getUTCMonth()+1)+'-'+f(this.getUTCDate())+'T'+f(this.getUTCHours())+':'+f(this.getUTCMinutes())+':'+f(this.getUTCSeconds())+'Z':null;};String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(key){return this.valueOf();};}var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={'\b':'\\b','\t':'\\t','\n':'\\n','\f':'\\f','\r':'\\r','"':'\\"','\\':'\\\\'},rep;function quote(string){escapable.lastIndex=0;return escapable.test(string)?'"'+string.replace(escapable,function(a){var c=meta[a];return typeof c==='string'?c:'\\u'+('0000'+a.charCodeAt(0).toString(16)).slice(-4);})+'"':'"'+string+'"';}function str(key,holder){var i,k,v,length,mind=gap,partial,value=holder[key];if(value&&typeof value==='object'&&typeof value.toJSON==='function'){value=value.toJSON(key);}if(typeof rep==='function'){value=rep.call(holder,key,value);}switch(typeof value){case'string':return quote(value);case'number':return isFinite(value)?String(value):'null';case'boolean':case'null':return String(value);case'object':if(!value){return'null';}gap+=indent;partial=[];if(Object.prototype.toString.apply(value)==='[object Array]'){length=value.length;for(i=0;i<length;i+=1){partial[i]=str(i,value)||'null';}v=partial.length===0?'[]':gap?'[\n'+gap+partial.join(',\n'+gap)+'\n'+mind+']':'['+partial.join(',')+']';gap=mind;return v;}if(rep&&typeof rep==='object'){length=rep.length;for(i=0;i<length;i+=1){k=rep[i];if(typeof k==='string'){v=str(k,value);if(v){partial.push(quote(k)+(gap?': ':':')+v);}}}}else{for(k in value){if(Object.hasOwnProperty.call(value,k)){v=str(k,value);if(v){partial.push(quote(k)+(gap?': ':':')+v);}}}}v=partial.length===0?'{}':gap?'{\n'+gap+partial.join(',\n'+gap)+'\n'+mind+'}':'{'+partial.join(',')+'}';gap=mind;return v;}}if(typeof JSON.stringify!=='function'){JSON.stringify=function(value,replacer,space){var i;gap='';indent='';if(typeof space==='number'){for(i=0;i<space;i+=1){indent+=' ';}}else if(typeof space==='string'){indent=space;}rep=replacer;if(replacer&&typeof replacer!=='function'&&(typeof replacer!=='object'||typeof replacer.length!=='number')){throw new Error('JSON.stringify');}return str('',{'':value});};}if(typeof JSON.parse!=='function'){JSON.parse=function(text,reviver){var j;function walk(holder,key){var k,v,value=holder[key];if(value&&typeof value==='object'){for(k in value){if(Object.hasOwnProperty.call(value,k)){v=walk(value,k);if(v!==undefined){value[k]=v;}else{delete value[k];}}}}return reviver.call(holder,key,value);}cx.lastIndex=0;if(cx.test(text)){text=text.replace(cx,function(a){return'\\u'+('0000'+a.charCodeAt(0).toString(16)).slice(-4);});}if(/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,'@').replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,']').replace(/(?:^|:|,)(?:\s*\[)+/g,''))){j=eval('('+text+')');return typeof reviver==='function'?walk({'':j},''):j;}throw new SyntaxError('JSON.parse');};}}());

	String.prototype.visualLength = function(fontFamily)
	{
	    var ruler = document.getElementById("ruler");
	    ruler.style.font = fontFamily;
	    ruler.innerHTML = this;
	    return ruler.offsetWidth;
	}

	function encode(text){
		var repl=[["À","&#192;"],["Á","&#193;"],["Â","&#194;"],["Ã","&#195;"],["Ä","&#196;"],["Å","&#197;"],["Æ","&#198;"],["Ç","&#199;"],["È","&#200;"],["É","&#201;"],["Ê","&#202;"],["Ë","&#203;"],["Ì","&#204;"],["Í","&#205;"],["Î","&#206;"],["Ï","&#207;"],["Ð","&#208;"],["Ñ","&#209;"],["Ò","&#210;"],["Ó","&#211;"],["Ô","&#212;"],["Õ","&#213;"],["Ö","&#214;"],["Ø","&#216;"],["Ù","&#217;"],["Ú","&#218;"],["Û","&#219;"],["Ü","&#220;"],["Ý","&#221;"],["Þ","&#222;"],["ß","&#223;"],["à","&#224;"],["á","&#225;"],["â","&#226;"],["ã","&#227;"],["ä","&#228;"],["å","&#229;"],["æ","&#230;"],["ç","&#231;"],["è","&#232;"],["é","&#233;"],["ê","&#234;"],["ë","&#235;"],["ì","&#236;"],["í","&#237;"],["î","&#238;"],["ï","&#239;"],["ð","&#240;"],["ñ","&#241;"],["ò","&#242;"],["ó","&#243;"],["ô","&#244;"],["õ","&#245;"],["ö","&#246;"],["ø","&#248;"],["ù","&#249;"],["ú","&#250;"],["û","&#251;"],["ü","&#252;"],["ý","&#253;"],["þ","&#254;"],["ÿ","&#255;"]];
		repl.forEach(function(c) {text=text.replace(eval("/" + c[0] + "/g"), c[1]);})
		return text;
	}



</script>



<script type="text/javascript+protovis">
var doctype='<?xml version="1.0" standalone="no"?> <!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd"> '
var data =[{category:"",value0:0,value1:0,value2:0}];
var x1=pv.Scale.linear(0,1).range(0,1);
var y1=x1;
var y2=pv.Scale.ordinal(1).splitBanded(0,1,4/5);
var x2=x1;
var x3=y2;
var nbSeries=1;
y=pv.Scale.linear(0,1).range(0, 400);
var w=600,margin=20,axis=20,h=400,header=20,footer=20, source;
//var colorsFB=["#0087b0", "#ff9108", "#954b16", "#488fbc", "#cf0f16", "#9abc29", "#762953", "#005e9a", "#419748", "#f76114", "#5b528f", "#003a73"];
var colors=["#0078ba","#b2b2b2","#af418e","#97bf0d","#ed4e70","#ffdd00","#e5352d","#009036","#e15c12","#009ee0"];
var sColor,chartType,vis,myMin,myMax,fontTitle, fontSubtitle, fontLabel, fontUnit, cUrl, cw,ch, hTitle, myMin, myMax;
var stdFont="'Helvetica Neue', Arial, Helvetica, sans-serif"
var titleRows=[];
var legends=[];
var myColors=[];
var csvRows = [];
var objArr = [];
var dots =0;
var chevron=[
{x:0.0167, y:0.0167},
{x:0.4667, y:0.3833},
{x:0.4667, y:0.6167},
{x:0.0167, y:0.9833},
{x:0.0167, y:0.75},
{x:0.3333, y:0.5},
{x:0.0167, y:0.25}
];
var digits=0;
var blueTitle=1;
var lAngle =0,hTicks =1,vTicks =0,mX=-1,vertical = false,properCode="",fullCode="";
var serializer=new XMLSerializer;
function setMessage (message, error)

{	document.getElementById("message").innerHTML = '<p>' + message + '</p>';
	if (error)
		document.getElementById("message").className = "error";
	else
		document.getElementById("message").className = "";
}

function parseCSVLine (line)

{
	line = line.split(/[\t,]/g)
	// check for splits performed inside quoted strings and correct if needed
	for (var i = 0; i < line.length; i++)
	{
		var chunk = line[i].replace(/^[\s]*|[\s]*$/g, "");
		var quote = "";
		if (chunk.charAt(0) == '"' || chunk.charAt(0) == "'") quote = chunk.charAt(0);
		if (quote != "" && chunk.charAt(chunk.length - 1) == quote) quote = "";
		if (quote != "")
		{
			var j = i + 1;
			if (j < line.length) chunk = line[j].replace(/^[\s]*|[\s]*$/g, "");
			while (j < line.length && chunk.charAt(chunk.length - 1) != quote)
			{
				line[i] += ',' + line[j];
				line.splice(j, 1);
				chunk = line[j].replace(/[\s]*$/g, "");
			}
			if (j < line.length)
			{
				line[i] += ',' + line[j];
				line.splice(j, 1);
			}
		}
	}
	for (var i = 0; i < line.length; i++)
	{
		// remove leading/trailing whitespace
		line[i] = line[i].replace(/^[\s]*|[\s]*$/g, "");

		// remove leading/trailing quotes
		if (line[i].charAt(0) == '"') line[i] = line[i].replace(/^"|"$/g, "");
		else if (line[i].charAt(0) == "'") line[i] = line[i].replace(/^'|'$/g, "");
	}
	return line;
}

function csvToJson () {
	var message = "";
	var error = false;
	var f = document.forms["convertForm"];
	var csvText = f.elements["csv"].value;
	if(f.elements["size"].value==0){
			w=800;h=533;
			if(f.elements["ffTitle"].value==""||f.elements["ffTitle"].value=="auto") {fontTitle="bold 32px "+stdFont;f.elements["ffTitle"].value=fontTitle} else {fontTitle=f.elements["ffTitle"].value;}
			if(f.elements["ffsTitle"].value==""||f.elements["ffsTitle"].value=="auto") {fontSubtitle="24px "+stdFont;f.elements["ffsTitle"].value=fontSubtitle} else {fontSubtitle=f.elements["ffsTitle"].value;}
			if(f.elements["ffLabel"].value==""||f.elements["ffLabel"].value=="auto") {fontLabel="16px "+stdFont;f.elements["ffLabel"].value=fontLabel} else {fontLabel=f.elements["ffLabel"].value;}
			if(f.elements["ffUnit"].value==""||f.elements["ffUnit"].value=="auto") {fontUnit="16px "+stdFont;f.elements["ffUnit"].value=fontUnit} else {fontUnit=f.elements["ffUnit"].value;}

			lMargin=46;cUrl="chevrons/large.png";hTitle=87; cw=40; ch=80;
			vertical=false;
	}
	else if(f.elements["size"].value==1){
		w=600;h=400;
		if(f.elements["ffTitle"].value==""||f.elements["ffTitle"].value=="auto") {fontTitle="bold 24px "+stdFont;f.elements["ffTitle"].value=fontTitle} else {fontTitle=f.elements["ffTitle"].value;}
		if(f.elements["ffsTitle"].value==""||f.elements["ffsTitle"].value=="auto") {fontSubtitle="24px "+stdFont;f.elements["ffsTitle"].value=fontSubtitle} else {fontSubtitle=f.elements["ffsTitle"].value;}
		if(f.elements["ffLabel"].value==""||f.elements["ffLabel"].value=="auto") {fontLabel="12px "+stdFont;f.elements["ffLabel"].value=fontLabel} else {fontLabel=f.elements["ffLabel"].value;}
		if(f.elements["ffUnit"].value==""||f.elements["ffUnit"].value=="auto") {fontUnit="12px "+stdFont;f.elements["ffUnit"].value=fontUnit} else {fontUnit=f.elements["ffUnit"].value;}

		lMargin=35;cUrl="chevrons/large.png";hTitle=65; cw=30; ch=60;
		vertical=false;
	} else if(f.elements["size"].value==2){
		w=330;h=220;

		if(f.elements["ffTitle"].value==""||f.elements["ffTitle"].value=="auto") {fontTitle="bold 14px "+stdFont;f.elements["ffTitle"].value=fontTitle} else {fontTitle=f.elements["ffTitle"].value;}
		if(f.elements["ffsTitle"].value==""||f.elements["ffsTitle"].value=="auto") {fontSubtitle="12px "+stdFont;f.elements["ffsTitle"].value=fontSubtitle} else {fontSubtitle=f.elements["ffsTitle"].value;}
		if(f.elements["ffLabel"].value==""||f.elements["ffLabel"].value=="auto") {fontLabel="10px "+stdFont;f.elements["ffLabel"].value=fontLabel} else {fontLabel=f.elements["ffLabel"].value;}
		if(f.elements["ffUnit"].value==""||f.elements["ffUnit"].value=="auto") {fontUnit="10px "+stdFont;f.elements["ffUnit"].value=fontUnit} else {fontUnit=f.elements["ffUnit"].value;}


		lMargin=20;cUrl="chevrons/medium.png";hTitle=40; cw=15;ch=30;
		vertical=false;
	} else if(f.elements["size"].value==3){
		w=260;h=195;

		if(f.elements["ffTitle"].value==""||f.elements["ffTitle"].value=="auto") {fontTitle="bold 12px "+stdFont;f.elements["ffTitle"].value=fontTitle} else {fontTitle=f.elements["ffTitle"].value;}
		if(f.elements["ffsTitle"].value==""||f.elements["ffsTitle"].value=="auto") {fontSubtitle="12px "+stdFont;f.elements["ffsTitle"].value=fontSubtitle} else {fontSubtitle=f.elements["ffsTitle"].value;}
		if(f.elements["ffLabel"].value==""||f.elements["ffLabel"].value=="auto") {fontLabel="9px "+stdFont;f.elements["ffLabel"].value=fontLabel} else {fontLabel=f.elements["ffLabel"].value;}
		if(f.elements["ffUnit"].value==""||f.elements["ffUnit"].value=="auto") {fontUnit="9px "+stdFont;f.elements["ffUnit"].value=fontUnit} else {fontUnit=f.elements["ffUnit"].value;}

		lMargin=20;cUrl="chevrons/medium.png";hTitle=40;cw=15;ch=30;
		vertical=false;
	} else if(f.elements["size"].value==4){
		w=250;h=200;
		if(f.elements["ffTitle"].value==""||f.elements["ffTitle"].value=="auto") {fontTitle="bold 12px "+stdFont;f.elements["ffTitle"].value=fontTitle} else {fontTitle=f.elements["ffTitle"].value;}
		if(f.elements["ffsTitle"].value==""||f.elements["ffsTitle"].value=="auto") {fontSubtitle="12px "+stdFont;f.elements["ffsTitle"].value=fontSubtitle} else {fontSubtitle=f.elements["ffsTitle"].value;}
		if(f.elements["ffLabel"].value==""||f.elements["ffLabel"].value=="auto") {fontLabel="9px "+stdFont;f.elements["ffLabel"].value=fontLabel} else {fontLabel=f.elements["ffLabel"].value;}
		if(f.elements["ffUnit"].value==""||f.elements["ffUnit"].value=="auto") {fontUnit="9px "+stdFont;f.elements["ffUnit"].value=fontUnit} else {fontUnit=f.elements["ffUnit"].value;}


		lMargin=20;cUrl="chevrons/medium.png";hTitle=35;cw=15;ch=30;
		vertical=false;
	} else {
		w=130;h=250;

		if(f.elements["ffTitle"].value==""||f.elements["ffTitle"].value=="auto") {fontTitle="bold 10px Helvetica";f.elements["ffTitle"].value=fontTitle} else {fontTitle=f.elements["ffTitle"].value;}
		if(f.elements["ffsTitle"].value==""||f.elements["ffsTitle"].value=="auto") {fontSubtitle="10px Helvetica";f.elements["ffsTitle"].value=fontSubtitle} else {fontSubtitle=f.elements["ffsTitle"].value;}
		if(f.elements["ffLabel"].value==""||f.elements["ffLabel"].value=="auto") {fontLabel="9px Helvetica";f.elements["ffLabel"].value=fontLabel} else {fontLabel=f.elements["ffLabel"].value;}
		if(f.elements["ffUnit"].value==""||f.elements["ffUnit"].value=="auto") {fontUnit="9px Helvetica";f.elements["ffUnit"].value=fontTitle} else {fontUnit=f.elements["ffUnit"].value;}

		lMargin=15;cUrl="chevrons/small.png";hTitle=25;cw=10;ch=20;
		vertical=true;
	}

	for(var i=0;i<3;i++){
		if(f.elements["chartType"][i].checked){
			chartType=i;
		}
	}
	if(f.elements["dots"].checked){dots=1;}else{dots=0;}
	if(f.elements["blue"].checked){blueTitle=1;}else{blueTitle=0;}

	if(f.elements["lAngle"].value==0){lAngle=0;}
	if(f.elements["lAngle"].value==1){lAngle=-Math.PI/6;}
	if(f.elements["lAngle"].value==2){lAngle=-Math.PI/4;}
	if(f.elements["lAngle"].value==3){lAngle=-Math.PI/2;}


	// colors

	for(var i=0;i<10;i++){
		if(f.elements["sColor"][i].checked){
			sColor=i;
			myColors[0]=colors[sColor];				// main color
			myColors[1]=colors[(sColor+1) % 10];	// color of series #2
			myColors[2]=colors[(sColor+2) % 10];	// color of series #3
			myColors[3]=colors[(sColor+3) % 10];	// highlight color
		}
	}



	titleRows = f.elements["title"].value.split(/[\r\n]/g);
	source = f.elements["source"].value;
	legends=[];
	if(f.elements["unit1"].value!=""){legends.push(f.elements["unit1"].value);}
	if(f.elements["unit2"].value!=""){legends.push(f.elements["unit2"].value);}
	if(f.elements["unit3"].value!=""){legends.push(f.elements["unit3"].value);}
	nbSeries=Math.max(1,legends.length);

	hTicks=(f.elements["hTicks"].value)?parseFloat(f.elements["hTicks"].value):0;
	vTicks=parseFloat(f.elements["vTicks"].value)?parseFloat(f.elements["vTicks"].value):0;

	digits=(f.elements["digits"].value)?parseFloat(f.elements["digits"].value):0;

	var jsonText = "";

	setMessage(message, error);

	if (csvText == "") { error = true; message = "Enter CSV text below."; }

	if (!error)

	{
		csvRows = csvText.split(/[\r\n]/g); // split into rows
		// get rid of empty rows
		for (var i = 0; i < csvRows.length; i++)
		{
			if (csvRows[i].replace(/^[\s]*|[\s]*$/g, '') == "")
			{
				csvRows.splice(i, 1);
				i--;
			}
		}

		if (csvRows.length < 2) { error = true; message = "The CSV text MUST have a header row!"; }
		else
		{
			objArr = [];
			for (var i = 0; i < csvRows.length; i++)
			{
				csvRows[i] = parseCSVLine(csvRows[i]);
			}
			for (var i = 0; i < csvRows.length; i++)
			{
				if (csvRows[i].length > 0) objArr.push({});
				objArr[i]["category"]=csvRows[i][0];
				//for (var j = 1; j < csvRows[i].length; j++) {
				for (var j = 1; j < 4; j++) { // now all lines have 3 reliable values.
					objArr[i]["value"+(j-1)] = (j<csvRows[i].length)?parseFloat(csvRows[i][j]):0;
				}
			}

			data = objArr;

			if(chartType==1){
				myMin=pv.min(data, function(d) d.value0+d.value1+d.value2);myMax=pv.max(data, function(d) d.value0+d.value1+d.value2);
			} else {
				var myMin0=pv.min(data, function(d) d.value0);var myMax0=pv.max(data, function(d) d.value0);
				var myMin1=pv.min(data, function(d) d.value1);var myMax1=pv.max(data, function(d) d.value1);
				var myMin2=pv.min(data, function(d) d.value2);var myMax2=pv.max(data, function(d) d.value2);
				myMin=myMin0;
				if(myMin1<myMin){
					myMin=myMin1;
				}
				if(myMin2<myMin){
					myMin=myMin2;
				}
				myMax=myMax0;
				if(myMax1>myMax){
					myMax=myMax1;
				}
				if(myMax2>myMax){
					myMax=myMax2;
				}
			}
			if (myMin>0){myMin=0;}
		}

	if(f.elements["fMin"].value!="auto"){myMin=parseFloat(f.elements["fMin"].value);}
	if(f.elements["fMax"].value!="auto"){myMax=parseFloat(f.elements["fMax"].value);}

	// define header, margin, axis and footer

	if(f.elements["header"].value=="auto"){
		if(f.elements["size"].value==1){header=30+hTitle;}
		if(f.elements["size"].value==2){header=20+hTitle;}
		if(f.elements["size"].value==3){header=20+hTitle;}
		if(f.elements["size"].value==4){header=20+hTitle;}
		if(f.elements["size"].value==5){header=10+hTitle;}
	}else{header=parseFloat(f.elements["header"].value);}

	if(f.elements["margin"].value=="auto"){
		if(f.elements["size"].value==1){margin=30;}
		if(f.elements["size"].value==2){margin=20;}
		if(f.elements["size"].value==3){margin=20;}
		if(f.elements["size"].value==4){margin=20;}
		if(f.elements["size"].value==5){margin=10;}
	} else {margin=parseFloat(f.elements["margin"].value);}

	if(f.elements["axis"].value=="auto"){
		axis=(myMax+'').visualLength(fontLabel)+5;
	} else {
		axis=parseFloat(f.elements["axis"].value);
	}

	if(f.elements["footer"].value=="auto"){
		if(f.elements["size"].value==1){footer=65;}
		if(f.elements["size"].value==2){footer=50;}
		if(f.elements["size"].value==3){footer=50;}
		if(f.elements["size"].value==4){footer=50;}
		if(f.elements["size"].value==5){footer=30;}
		if (lAngle!=0) {
			footer += pv.max(data, function(d) (12*Math.cos(lAngle)-d.category.visualLength(fontLabel)*Math.sin(lAngle)))-12;
		}
	}
	else {
		footer=parseFloat(f.elements["footer"].value);
	}


	//header=20;
	//footer=20;
	//margin=20;
	//axis=20;

	if(chartType==2) { // line chart
		x1 = pv.Scale.linear(0,data.length-1).range(0, w-axis-margin);
		y1 = pv.Scale.linear(myMin, myMax).range(0, h-header-footer);
	} else {
		if(vertical) { // small, vertical charts see their axes inverted.
			y2 = pv.Scale.ordinal(pv.range(data.length)).splitBanded(0, h-header-footer, 4/5);
			x2 = pv.Scale.linear(myMin, myMax).range(0, w-margin-axis);
		} else { // larger charts have categories along the x-axis
			x3 = pv.Scale.ordinal(pv.range(data.length)).splitBanded(0, w-margin-axis, 4/5);
			y1 = pv.Scale.linear(myMin, myMax).range(0, h-header-footer);
		}
	}


	createProperCode();
	eval(properCode);
	}
//	message="done.";
//	setMessage(message, error);

}
</script>
<script type="text/javascript">
function createProperCode(){
	var ender=";\n" // ";" when not debugging
	fullCode="<script type=\"text/javascript+protovis\">";
	properCode=							"var data="+JSON.stringify(objArr, null)+ender;
	properCode+=						"var chevron=[{x:0.0167, y:0.0167},{x:0.4667, y:0.3833},{x:0.4667, y:0.6167},{x:0.0167, y:0.9833},{x:0.0167, y:0.75},{x:0.3333, y:0.5},{x:0.0167, y:0.25}]"+ender;

	if(chartType==2){
		properCode+=					"var x=pv.Scale.linear(0,"+(data.length-1)+").range(0,"+(w-axis-margin)+")"+ender;
	   	properCode+=					"var y=pv.Scale.linear("+myMin+", "+myMax+").range(0, "+(h-header-footer)+")"+ender;
	} else if (vertical) {
	    properCode+=					"var y=pv.Scale.ordinal(pv.range("+data.length+")).splitBanded(0, "+(h-header-footer)+",4/5)"+ender;
	    properCode+=					"var x=pv.Scale.linear("+myMin+", "+myMax+").range(0, "+(w-margin-axis)+")"+ender;
	} else {
	    properCode+=					"var x=pv.Scale.ordinal(pv.range("+data.length+")).splitBanded(0, "+(w-axis-margin)+",4/5)"+ender;
	    properCode+=					"var y=pv.Scale.linear("+myMin+", "+myMax+").range(0, "+(h-header-footer)+")"+ender;
	}

	properCode+=						"var vis=new pv.Panel().width(" + w + ").height(" + h +").fillStyle(\"#fff\").strokeStyle(";
	properCode+=							(blueTitle?"\""+colors[0]+"\"":undefined)+")"
	properCode+=							".canvas('chart')"+ender;

	properCode+=						"var myChart = vis.add(pv.Panel).width(" + (w-margin-axis) + ").height(" + (h-footer-header) +").left(" + axis + ").top("+ header +")"+ender;


	///////////////////////////////////////////////////////////////////////
	//
	//	gridlines for line chart
	//
	//  (in that case we draw the gridline first, whereas we draw it over
	//  the chart for bar/column charts
	//
	///////////////////////////////////////////////////////////////////////

	if (chartType==2) {
				properCode+=					"myChart.add(pv.Rule).data(data)";
				properCode+=					".visible(function() {return (this.index >= 0)&&(("+hTicks+"==0)||!(this.index % "+hTicks+"));})";
				properCode+=					".left(function(d) {return Math.round(x(this.index)) - .5;})";
				properCode+=					".strokeStyle(\"#eee\")";
				properCode+=					".anchor(\"bottom\").add(pv.Label)";
				properCode+=					".textMargin(" + (lAngle?10:5)+")";
				properCode+=					".font(\""+fontLabel+"\")";
				properCode+=					".text(function(d) {return d.category;})";
				properCode+=					(lAngle&&(!vertical))?".textAngle("+lAngle+")":"";
				properCode+=					".textAlign("+ (lAngle?"\"right\")":"function() {return (this.index>0?((this.index<data.length-1)?\"center\":\"right\"):\"left\");})");
				properCode+=					ender

				properCode+=					"myChart.add(pv.Rule)";
				properCode+=					".data("+(vTicks?"y.ticks("+vTicks+")":"y.ticks()")+")";
				properCode+=					".bottom(function(d) {return Math.round(y(d)) - .5;})";
				properCode+=					".strokeStyle(\"#eee\")";
				properCode+=					ender

				properCode+=					"myChart.add(pv.Rule)";
				properCode+=					".data("+(vTicks?"y.ticks("+vTicks+")":"y.ticks()")+")";
				properCode+=					".bottom(function(d) {return Math.round(y(d))-.5;})";
				properCode+=					".strokeStyle(function(d) {return d ? \"rgba(255,255,255,.3)\":\"#000\";})";
				properCode+=					".add(pv.Rule).left(0).width(5).strokeStyle(\"#000\").anchor(\"left\").add(pv.Label)";
				properCode+=					".font(\""+fontLabel+"\")";
				properCode+=					".text(function(d) {return d.toFixed(digits);})";
				properCode+=					ender
		}

	///////////////////////////////////////////////////////////////////////
	//
	// The chart proper
	//
	///////////////////////////////////////////////////////////////////////


	if (chartType!=2){	// not a line chart
		if(vertical) {	// this is the equivalent of the animV panel.

			properCode+=				"var anim = myChart.add(pv.Panel).data(data).top(function() {return y(this.index);})";
			properCode+=				ender
			properCode+=				"anim.add(pv.Bar).top(0)";
			properCode+=					".height(y.range().band)";
			if((chartType==0)&&(nbSeries>1)){
				properCode+=				".height(y.range().band/"+nbSeries+")";
			} else {
				properCode+=				".height(y.range().band)";
			}

			properCode+=					".width(function(d) {return x(0)>x(d.value0)?(x(0)-x(d.value0)):(x(d.value0)-x(0));})";
			properCode+=					".left(function(d) {return x(0)<x(d.value0)?x(0):x(d.value0);})";
			properCode+=					".def(\"fillStyle\", \""+myColors[0]+"\")";
			properCode+=					".event(\"mouseover\", function() {return this.fillStyle(\""+myColors[nbSeries]+"\");})";
			properCode+=					".event(\"mouseout\", function() {return this.fillStyle(undefined);})";
			properCode+=					".title(function(d) {return d.category+\": \"+d.value0;})"
			properCode+=					ender
			if(nbSeries>1){
				properCode+=			"anim.add(pv.Bar)"
				if(chartType==0){
					properCode+=			".top(y.range().band/"+nbSeries+")";
					properCode+=			".height(y.range().band/"+nbSeries+")";
					properCode+=			".left(function(d) {return x(0)<x(d.value1)?x(0):x(d.value1);})";
				}else{
					properCode+=			".top(0)";
					properCode+=			".height(y.range().band/"+nbSeries+")";
					properCode+=			".left(function(d) {return (x(d.value0);})";
				}
				properCode+=				".width(function(d) {return x(0)>x(d.value1)?(x(0)-x(d.value1)):(x(d.value1)-x(0));})";
				properCode+=				".def(\"fillStyle\", \""+myColors[1]+"\")";
				properCode+=				".event(\"mouseover\", function() {return this.fillStyle(\""+myColors[nbSeries]+"\");})";
				properCode+=				".event(\"mouseout\", function() {return this.fillStyle(undefined);})";
				properCode+=				".title(function(d) {return d.category+\": \"+d.value1;})"
				properCode+=				ender
			}
			if(nbSeries>2){
				properCode+=			"anim.add(pv.Bar)"
				if(chartType==0){
					properCode+=			".top(2*y.range().band/3)";
					properCode+=			".height(y.range().band/3)";
					properCode+=			".left(function(d) {return x(0)<x(d.value2)?x(0):x(d.value2);})";
				}else{
					properCode+=			".top(0)";
					properCode+=			".height(y.range().band/3)";
					properCode+=			".left(function(d) {return (x(d.value0)+x(d.value1);})";
				}
				properCode+=				".width(function(d) {return x(0)>x(d.value2)?(x(0)-x(d.value2)):(x(d.value2)-x(0));})";
				properCode+=				".def(\"fillStyle\", \""+myColors[2]+"\")";
				properCode+=				".event(\"mouseover\", function() {return this.fillStyle(\""+myColors[nbSeries]+"\");})";
				properCode+=				".event(\"mouseout\", function() {return this.fillStyle(undefined);})";
				properCode+=				".title(function(d) {return d.category+\": \"+d.value2;})"
				properCode+=				ender
			}
		}	else {	// this is the code that corresponds to animH. we are looking at a normal bar charts, ie bars are vertical columns.
				properCode+=				"var anim = myChart.add(pv.Panel).data(data).left(function() {return x(this.index);})";
				properCode+=				".add(pv.Bar).left(0)"
				if(chartType==0&&nbSeries>1){
					properCode+=			".width(x.range().band/"+nbSeries+")";
				}
				else{
					properCode+=			".width(x.range().band)";
				}
				properCode+=				".height(function(d) {return y(0)>y(d.value0)?y(0)-y(d.value0):y(d.value0)-y(0);})";
				properCode+=				".bottom(function(d) {return y(0)<y(d.value0)?y(0):y(d.value0);})";
				properCode+=				".def(\"fillStyle\", \""+myColors[0]+"\")";
				properCode+=				".event(\"mouseover\", function() {return this.fillStyle(\""+myColors[nbSeries]+"\");})";
				properCode+=				".event(\"mouseout\", function() {return this.fillStyle(undefined);})";
				properCode+=				".title(function(d) {return d.category+\": \"+d.value0;})"
				properCode+=				ender
				if(nbSeries>1){
					properCode+=			"anim.add(pv.Bar)"
					if(chartType==0){
						properCode+=		".left(x.range().band/"+nbSeries+")";
						properCode+=		".width(x.range().band/"+nbSeries+")";
						properCode+=		".bottom(function(d) {return y(0)<y(d.value1)?y(0):y(d.value1);})"
						}
					else{
						properCode+=		".left(0)";
						properCode+=		".width(x.range().band)";
						properCode+=		".bottom(function(d) {return y(d.value0);})";
					}

					properCode+=			".height(function(d) {return y(0)>y(d.value1)?y(0)-y(d.value1):y(d.value1)-y(0);})";
					properCode+=			".def(\"fillStyle\", \""+myColors[1]+"\")";
					properCode+=			".event(\"mouseover\", function() {return this.fillStyle(\""+myColors[nbSeries]+"\");})";
					properCode+=			".event(\"mouseout\", function() {return this.fillStyle(undefined);})";
					properCode+=			".title(function(d) {return d.category+\": \"+d.value1;})"
					properCode+=			ender
				}
				if(nbSeries>2){
					properCode+=			"anim.add(pv.Bar)"
					if(chartType==0){
						properCode+=		".left(2*x.range().band/3)";
						properCode+=		".width(x.range().band/3)";
						properCode+=		".bottom(function(d) {return y(0)<y(d.value2)?y(0):y(d.value2);})"
					}
					else{
						properCode+=		".left(0)";
						properCode+=		".width(x.range().band)";
						properCode+=		".bottom(function(d) {return y(d.value0+d.value1);})";
					}
					properCode+=			".height(function(d) {return y(0)>y(d.value2)?y(0)-y(d.value2):y(d.value2)-y(0);})";
					properCode+=			".def(\"fillStyle\", \""+myColors[2]+"\")";
					properCode+=			".event(\"mouseover\", function() {return this.fillStyle(\""+myColors[nbSeries]+"\");})";
					properCode+=			".event(\"mouseout\", function() {return this.fillStyle(undefined);})";
					properCode+=			".title(function(d) {return d.category+\": \"+d.value2;})";
					properCode+=			ender
				}
			}
		} else {							// this is a line chart situation.
			properCode+=					"myChart.add(pv.Line).data(data).left(function() {return x(this.index);}).bottom(function(d) {return y(d.value0);}).lineWidth(3).strokeStyle(\""+myColors[0]+"\")";
			if(dots){
				properCode+=				".add(pv.Dot).size(20).lineWidth(1).title(function(d) {return d.category+\": \"+d.value0;}).def(\"fillStyle\",\""+myColors[0]+"\")";
				properCode+=				".event(\"mouseover\",function() {return this.fillStyle(\""+myColors[nbSeries+1]+"\");})";
				properCode+=				".event(\"mouseout\",function() {return this.fillStyle(undefined);});";}
			properCode+=					ender
			if(nbSeries>1){
				properCode+=				"myChart.add(pv.Line).data(data).left(function() {return x(this.index);}).bottom(function(d) {return y(d.value1);}).lineWidth(3).strokeStyle(\""+myColors[1]+"\")";
				if(dots){
					properCode+=			".add(pv.Dot).size(20).lineWidth(1).title(function(d) {return d.category+\": \"+d.value0;}).def(\"fillStyle\",\""+myColors[1]+"\")";
					properCode+=			".event(\"mouseover\",function() {return this.fillStyle(\""+myColors[nbSeries+1]+"\");})";
					properCode+=			".event(\"mouseout\",function() {return this.fillStyle(undefined);});";}
				properCode+=				ender
			}
			if(nbSeries>2){
				properCode+=				"myChart.add(pv.Line).data(data).left(function() {return x(this.index);}).bottom(function(d) {return y(d.value2);}).lineWidth(3).strokeStyle(\""+myColors[2]+"\")";
				if(dots){
					properCode+=			".add(pv.Dot).size(20).lineWidth(1).title(function(d) {return d.category+\": \"+d.value0;}).def(\"fillStyle\",\""+myColors[2]+"\")";
					properCode+=			".event(\"mouseover\",function() {return this.fillStyle(\""+myColors[nbSeries+1]+"\");})";
					properCode+=			".event(\"mouseout\",function() {return this.fillStyle(undefined);});";}
					properCode+=			ender
			}

		}

		///////////////////////////////////////////////////////////////////////
		//
		// Axes, etc.
		//
		///////////////////////////////////////////////////////////////////////
		//	the categorical axis
		///////////////////////////////////////////////////////////////////////


		if (chartType!=2) {
			properCode+=					"myChart.add(pv.Panel).data(data).left(";
			properCode+=					(vertical?"0":"function() {return this.index*"+(w-margin-axis)/data.length)+";})";
			properCode+=					".bottom(";
			properCode+=					(!vertical?"0":("function() {return ("+data.length+"-this.index*("+(h-header-footer)/data.length)+";}")+")";
			properCode+=					".width("+((w-margin-axis)/data.length)+")";
			properCode+=					".visible(function() {return ("+hTicks+"==0)||!(this.index % "+hTicks+");})";
			properCode+=					".anchor(\"bottom\").add(pv.Label).textMargin(5)";
			properCode+=					".textBaseline(\""+((lAngle||vertical)?"middle":"top")+"\")";
			properCode+=					".textAlign(\""+((lAngle||vertical)?"right":"center")+"\")";
			properCode+=					".font(\""+fontLabel+"\")";
			properCode+=					".text(function(d) {return d.category;})";
			properCode+=					(lAngle&&(!vertical))?".textAngle("+lAngle+")":"";
			properCode+=					ender


		//	the value axis
		///////////////////////////////////////////////////////////////////////

			if(vertical) {
				properCode+=				"myChart.add(pv.Rule)";
				properCode+=				".data("+(vTicks?"x.ticks("+vTicks+")":"x.ticks()")+")";
				properCode+=				".left(function(d) {return Math.round(x(d))-.5;})";
				properCode+=				".strokeStyle(function(d) {return d ? \"rgba(255,255,255,.3)\":\"#000\";})";
				properCode+=				".add(pv.Rule).bottom(0).height(5).strokeStyle(\"#000\").anchor(\"bottom\").add(pv.Label)";
				properCode+=				".font(\""+fontLabel+"\")";
				properCode+=				".text(function(d) {return d.toFixed("+digits+");})";
				properCode+=				ender

			}
			else {
				properCode+=				"myChart.add(pv.Rule)";
				properCode+=				".data("+(vTicks?"y.ticks("+vTicks+")":"y.ticks()")+")";
				properCode+=				".bottom(function(d) {return Math.round(y(d))-.5;})";
				properCode+=				".strokeStyle(function(d) {return d ? \"rgba(255,255,255,.3)\":\"#000\";})";
				properCode+=				".add(pv.Rule).left(0).width(5).strokeStyle(\"#000\").anchor(\"left\").add(pv.Label)";
				properCode+=				".font(\""+fontLabel+"\")";
				properCode+=				".text(function(d) {return d.toFixed("+digits+");})";
				properCode+=				ender
			}
		}
		///////////////////////////////////////////////////////////////////////
		//
		// The title
		//
		///////////////////////////////////////////////////////////////////////


		properCode+=						"vis.add(pv.Panel).left(0).top(0)";
		properCode+=						".height("+hTitle+")";
		properCode+=						".fillStyle("+(blueTitle?"\""+colors[0]+"\"":"undefined")+")";
		properCode+=						".add(pv.Line).data(chevron).top(function(d) {return "+(hTitle-ch)/2+"+"+ch+"*d.y;}).left(function(d) {return "+cw+"*d.x;})";
		properCode+=						".strokeStyle("+(blueTitle?"\"#fff\"":"\"#000\"")+").fillStyle("+(blueTitle?"\"#fff\"":"\"#000\"")+")";
		properCode+=						".add(pv.Line).data(chevron).top(function(d) {return "+(hTitle-ch)/2+"+"+ch+"*d.y;}).left(function(d) {return "+(lMargin/2)+"+"+cw+"*d.x;})";
		properCode+=						".strokeStyle("+(blueTitle?"\"#fff\"":"\"#000\"")+").fillStyle("+(blueTitle?"\"#fff\"":"\"#000\"")+")";
		properCode+=						ender
		if(titleRows[0]){
			properCode+=					"vis.add(pv.Label).data([\""+titleRows.slice(0,2).join('", "')+"\"])";
			properCode+=					".top("+hTitle/2+")";
			properCode+=					".left("+lMargin+")";
			properCode+=					".textAlign(\"left\")";
			properCode+=					".textBaseline(function() {return this.index?\"top\":\"bottom\";})";
			properCode+=					".textStyle("+(blueTitle?"\"#fff\"":"\"#000\"")+")";
			properCode+=					".font(function() {return this.index?\""+fontSubtitle+"\":\""+fontTitle+"\";})";
			properCode+=					".antialias(true)";
			properCode+=					ender
		}
		///////////////////////////////////////////////////////////////////////
		//
		// the legend
		//
		///////////////////////////////////////////////////////////////////////
		// legend
		///////////////////////////////////////////////////////////////////////
		if(legends.length){
			properCode+=						"vis.add(pv.Panel)";
			properCode+=						".data([\""+legends[0]+"\""
			properCode+=						legends.length>0?",\""+legends[1]+"\"":""
			properCode+=						legends.length>1?",\""+legends[2]+"\"":""
			properCode+=						"])";
			properCode+=						".width("+w/20+")";
			properCode+=						".height("+((h/20<10)?10:h/20)+")";
			properCode+=						".bottom(20)";
			properCode+=						".left(function() {return "+axis+"+this.index*"+((w-margin-axis-(w/20)-legends[legends.length-1].visualLength(fontUnit))/(legends.length-1))+";})";

			properCode+=						".fillStyle(function() {return myColors[this.index];})"
			properCode+=						".strokeStyle(null)"
			properCode+=						".anchor(\"right\").add(pv.Label).textAlign(\"left\")";
			properCode+=						".font(\""+fontUnit+"\")";
			properCode+=						ender
		}
		// source
		///////////////////////////////////////////////////////////////////////
		properCode+=							"vis.add(pv.Label).bottom(5).right(5).textAlign(\"right\").textBaseline(\"bottom\")";
		properCode+=							".font(\""+fontUnit+"\")";
		properCode+=							".text(\"Source: "+source+"\")";
		properCode+=							ender

	properCode+="vis.render();"
	fullCode+=properCode+"<\/script>";
	document.forms["result"].elements["code"].value=properCode;//fullCode;
	eval(properCode);
	document.forms["svg"].elements["svgoutput"].value=doctype+encode(serializer.serializeToString(document.getElementById('chart').childNodes[0]));

}
</script>

<div id="message" style:"display:none;"></div>
<form id="convertForm" name="convertForm" onsubmit="return false; ">
	<input type="button" value="Convert" onclick="csvToJson(); " /> <input type="reset" />
	<div id="formDiv">
		<div id="col1">
			<div id="dataDiv">
				<span class="tSpan"><label for="csv">Data:</label></span><input type="checkbox" name="blue" checked="true"/>Blue title<br />
				<textarea id="csv" name="csv" rows="10" cols="60"></textarea><br /><br />
			</div>
		</div><br/>
		<div id="col2">
			<div id="SizeDiv">
				<span class="tSpan">Size:</span>
				<select id="size">
					<option value=0>Very large (800x533)</option>
	  				<option value=1>Large (600x400)</option>
	  				<option selected value=2>Medium (330x220)</option>
	  				<option value=3>Small (260x195)</option>
	  				<option value=4>Thumbnail (250x200)</option>
	  				<option value=5>Vertical (130x250)</option>
				</select>
			</div><br/>
			<div id="MarginsDiv">
				<span class="tSpan">Margins:</span>
				top: <input type="text" name="header" size="3" value="auto" />&nbsp;bottom: <input size="3" type="text" name="footer" value="auto" />&nbsp;
				left: <input type="text" name="axis" size="3" value="auto" />&nbsp;right: <input size="3" type="text" name="margin" value="auto" /><br />
			</div><br/>
			<div id="TitlesDiv">
				<span class="tSpan">Titles:</span><br/>
				Main title:<br/>
				<textarea id="title" name="title" rows="3" cols="60" value="My chart"></textarea><br/>
				Source: <br/>
				<textarea id="source" name="source" rows="1" cols="60" style="resize:none;" />OECD</textArea>
				<br/>
				<table><tr><td>
					<span class="tSpan">Legends:</span></td><td><span class="tSpan">Series options:</span></td></tr><tr><td>

					Series 1: <input type="text" name="unit1" /><br/>
					Series 2: <input type="text" name="unit2" /><br/>
					Series 3: <input type="text" name="unit3" /><br/>

				</td><td>

					<table><tr><td>Label angle:</td><td>
					<select id="lAngle">
						<option value=0>0</option>
						<option value=1>-30&deg;</option>
						<option value=2>-45&deg;</option>
						<option value=3>-90&deg;</option>
					</select></td></tr><tr>
					<td>Interval between horizontal ticks:</td><td><input type="text" name="hTicks" size="3" /></td></tr><tr>
					<td>Number of vertical ticks:</td><td><input type="text" name="vTicks" size="3" value="auto"/></td></tr><tr>
					<td>Minimum:&nbsp;<input type="text" name="fMin" size="2" value="auto"/>&nbsp;
					Maximum:&nbsp;</td><td><input type="text" name="fMax" size="2" value="auto"/></td>
					<td>digits:</td><td><input type="digits" name="digits" size="2" value="0"/></td></tr></table>
				</td>
				</tr></table>
			</div>
			<div id="chartTypeDiv">
				<table><tr><td>
				<span class="tSpan">Chart type:</span>
				</td>
				<td><span class="tSpan">Fonts:</span></td>
				</tr>
				<td>
				<input type="radio" name="chartType" checked="true" value="0" />Clustered bars<br />
				<input type="radio" name="chartType" value="1" />Stacked bars<br />
				<input type="radio" name="chartType" value="2" />Lines<input type="checkbox" name="dots" />with dots<br />
				<br/></td>
				<td><table>
				<tr><td>Title:</td><td> <input type="text" name="ffTitle" value="auto" /> </td></tr>
				<tr><td>Subtitle:</td><td> <input type="text" name ="ffsTitle" value="auto" /> </td></tr>
				<tr><td>Labels:</td><td> <input type="text" name ="ffLabel" value="auto" /> </td></tr>
				<tr><td>Legends:</td><td> <input type="text" name ="ffUnit" value="auto" /> </td></tr></table>
				</td>
				</tr></table>
				<span class="tSpan">Color of main series: </span><br /><br/>
				<div style="float:left;">
				<div class="c0">&nbsp;<input type="radio" name="sColor" checked="true" value="0" /></div>
				<div class="c9">&nbsp;<input type="radio" name="sColor" value="1" /></div>
				<div class="c1">&nbsp;<input type="radio" name="sColor" value="2" /></div>
				<div class="c8">&nbsp;<input type="radio" name="sColor" value="3" /></div>
				<div class="c6">&nbsp;<input type="radio" name="sColor" value="4" /></div>
				<div class="c3">&nbsp;<input type="radio" name="sColor" value="5" /></div>
				<div class="c2">&nbsp;<input type="radio" name="sColor" value="6" /></div>
				<div class="c4">&nbsp;<input type="radio" name="sColor" value="7" /></div>
				<div class="c7">&nbsp;<input type="radio" name="sColor" value="8" /></div>
				<div class="c5">&nbsp;<input type="radio" name="sColor" value="9" /></div>
			</div>
		</div>
	&nbsp;
	</div>
	</br><input type="button" value="Convert" onclick="csvToJson(); " /> <input type="reset" />
</form>
<div id="chart">

</div>
<form id="result" name="result"><label>Javascript code:</label><input name="code" id="code"></form>
<form id="svg" name="svg"><label>SVG output:</label><input name="svgoutput" id="svgoutput"></form>
<span id="ruler"></span>
</body>
</html>