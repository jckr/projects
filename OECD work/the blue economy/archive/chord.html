<!DOCTYPE html>
<meta charset="utf-8">
<title>Chord diagram</title>
<link type="text/css" rel="stylesheet" href="chord.css"/>
<link type="text/css" rel="stylesheet" href="tipsy.css"/>
<link href="../bootstrap/css/bootstrap.css" rel="stylesheet">
<style>text{font-size:10px;}
.tipsy { font-size: 10px; position: absolute; padding: 5px; z-index: 100000; }
  .tipsy-inner { background-color: #000; color: #FFF; max-width: 200px; padding: 5px 8px 4px 8px; text-align: center; }

  /* Rounded corners */
  .tipsy-inner { border-radius: 3px; -moz-border-radius: 3px; -webkit-border-radius: 3px; }

  /* Uncomment for shadow */
  /*.tipsy-inner { box-shadow: 0 0 5px #000000; -webkit-box-shadow: 0 0 5px #000000; -moz-box-shadow: 0 0 5px #000000; }*/

  .tipsy-arrow { position: absolute; width: 0; height: 0; line-height: 0; border: 5px dashed #000; }

  /* Rules to colour arrows */
  .tipsy-arrow-n { border-bottom-color: #000; }
  .tipsy-arrow-s { border-top-color: #000; }
  .tipsy-arrow-e { border-left-color: #000; }
  .tipsy-arrow-w { border-right-color: #000; }

	.tipsy-n .tipsy-arrow { top: 0px; left: 50%; margin-left: -5px; border-bottom-style: solid; border-top: none; border-left-color: transparent; border-right-color: transparent; }
    .tipsy-nw .tipsy-arrow { top: 0; left: 10px; border-bottom-style: solid; border-top: none; border-left-color: transparent; border-right-color: transparent;}
    .tipsy-ne .tipsy-arrow { top: 0; right: 10px; border-bottom-style: solid; border-top: none;  border-left-color: transparent; border-right-color: transparent;}
  .tipsy-s .tipsy-arrow { bottom: 0; left: 50%; margin-left: -5px; border-top-style: solid; border-bottom: none;  border-left-color: transparent; border-right-color: transparent; }
    .tipsy-sw .tipsy-arrow { bottom: 0; left: 10px; border-top-style: solid; border-bottom: none;  border-left-color: transparent; border-right-color: transparent; }
    .tipsy-se .tipsy-arrow { bottom: 0; right: 10px; border-top-style: solid; border-bottom: none; border-left-color: transparent; border-right-color: transparent; }
  .tipsy-e .tipsy-arrow { right: 0; top: 50%; margin-top: -5px; border-left-style: solid; border-right: none; border-top-color: transparent; border-bottom-color: transparent; }
  .tipsy-w .tipsy-arrow { left: 0; top: 50%; margin-top: -5px; border-right-style: solid; border-left: none; border-top-color: transparent; border-bottom-color: transparent; }

</style>
<body>

<div class="container">



<div class="row"><div id="chart" class="span9"></div><div id="panel" class="span3"></div>
<footer class="span12">

<button onclick="changeMode();">Transition #1</button>
<button onclick="transMode();">Transition #2</button>
</footer>
</div>




<!-- Le javascript
================================================== -->
<!-- Placed at the end of the document so the pages load faster -->
<script src="../lib/jquery/jquery.js"></script>
<script src="../lib/jquery-ui/jquery-ui.min.js"></script>

<script src="../lib/jquery-ui/jquery.tipsy.js"></script>

<script src="../d3.v2.js">
</script>
<script>
var nodes={ARG:{name:"Argentina",exports:2612986658,imports:77824926,trade:2690811584},AUS:{name:"Australia",exports:1698678606,imports:1250250978,trade:2948929584},BEL:{name:"Belgium",exports:1751025944,imports:3019197621,trade:4770223565},BRA:{name:"Brazil",exports:398515714,imports:1913087898,trade:2311603612},CAN:{name:"Canada",exports:6793566201,imports:3246476478,trade:10040042679},CHL:{name:"Chile",exports:5073099109,imports:65889459,trade:5138988568},CHN:{name:"China",exports:17613571064,imports:8730920642,trade:26344491706},HKG:{name:"China, Hong Kong SAR",exports:812191155,imports:5491122156,trade:6303313311},DNK:{name:"Denmark",exports:4092969774,imports:2795650072,trade:6888619846},ECU:{name:"Ecuador",exports:2188107331,imports:432767277,trade:2620874608},EGY:{name:"Egypt",exports:30007329,imports:771817272,trade:801824601},FRA:{name:"France",exports:2572293017,imports:9368486389,trade:11940779406},DEU:{name:"Germany",exports:2856287974,imports:7515207878,trade:10371495852},GRC:{name:"Greece",exports:1352387919,imports:845261856,trade:2197649775},ISL:{name:"Iceland",exports:3248502613,imports:167354386,trade:3415856999},IND:{name:"India",exports:4327352036,imports:113599989,trade:4440952025},IDN:{name:"Indonesia",exports:4031191358,imports:432625460,trade:4463816818},ITA:{name:"Italy",exports:993715353,imports:8494566375,trade:9488281728},JPN:{name:"Japan",exports:2570754832,imports:23247630547,trade:25818385379},MYS:{name:"Malaysia",exports:1397577336,imports:1366801513,trade:2764378849},MEX:{name:"Mexico",exports:1290182268,imports:778977066,trade:2069159334},NLD:{name:"Netherlands",exports:4428825264,imports:3561956612,trade:7990781876},NZL:{name:"New Zealand",exports:1858939622,imports:126956594,trade:1985896216},NGA:{name:"Nigeria",exports:648073413,imports:1822354888,trade:2470428301},NOR:{name:"Norway",exports:17020285450,imports:680673270,trade:17700958720},PER:{name:"Peru",exports:989758824,imports:240322663,trade:1230081487},POL:{name:"Poland",exports:1884308580,imports:2680161356,trade:4564469936},PRT:{name:"Portugal",exports:1433496039,imports:3313484716,trade:4746980755},KOR:{name:"Rep. of Korea",exports:2791441114,imports:5550318180,trade:8341759294},RUS:{name:"Russian Federation",exports:4325697592,imports:4045873198,trade:8371570790},SGP:{name:"Singapore",exports:603346461,imports:1414126406,trade:2017472867},ESP:{name:"Spain",exports:5117408321,imports:11359672459,trade:16477080780},SWE:{name:"Sweden",exports:4939395824,imports:5847095234,trade:10786491058},CHE:{name:"Switzerland",exports:7938996,imports:935095097,trade:943034093},THA:{name:"Thailand",exports:5734303914,imports:4054111680,trade:9788415594},GBR:{name:"United Kingdom",exports:3847097386,imports:4511235070,trade:8358332456},USA:{name:"USA",exports:8036762210,imports:23649189986,trade:31685952196}};var links={USA:{CHN:1910701469,JPN:195470193,NOR:513556935,ESP:26577464,FRA:20406850,CAN:2034890863,THA:1061430104,RUS:272149781,GBR:155755128,KOR:77163489,NLD:33574275,DNK:20635779,CHL:601634018,POL:34427803,IDN:734349841,IND:345632194,ISL:103616026,AUS:45931881,MYS:162556730,ARG:77650690,ECU:589318609,BRA:110320448,GRC:23411715,MEX:357949780,SGP:35848847,NZL:134343920,PER:122076027},CHN:{USA:720394920,JPN:298524858,NOR:400336368,ESP:29710898,FRA:13791015,DEU:13215496,CAN:214082473,THA:128905235,RUS:1261645627,GBR:17640222,KOR:149519209,NLD:116356984,DNK:21442069,CHL:52074091,PRT:15325857,IDN:67828817,IND:155826933,ISL:28172152,AUS:45695629,MYS:43869892,ARG:16079144,MEX:30044581,NZL:96611486,PER:25751445},JPN:{USA:1200418757,CHN:1108510136,NOR:759111655,ESP:85340348,FRA:31253587,DEU:25743188,CAN:442785159,THA:691237361,ITA:15685006,RUS:1167143471,GBR:13900211,KOR:697217182,NLD:38037370,DNK:48155256,HKG:148994682,CHL:1095431181,PRT:19281255,IDN:627986316,IND:348517169,ISL:119549077,AUS:244943286,MYS:84374490,ARG:85707635,ECU:18652312,BRA:11160443,GRC:15352990,MEX:44135843,NZL:119843971,PER:19418765},NOR:{USA:29524836,CHN:22222832,CAN:13539489,THA:12119642,RUS:59899878,GBR:67147185,DNK:29512418,ISL:10597806},ESP:{USA:114124848,CHN:384467189,NOR:127966997,FRA:323125708,SWE:75379367,DEU:40607628,CAN:21250064,THA:68360281,ITA:206290681,GBR:274144297,KOR:45306716,NLD:224352872,DNK:187587603,CHL:126802003,BEL:44510555,PRT:297914245,IND:182133335,ISL:117206966,ARG:498523081,ECU:142474366,BRA:12266487,GRC:106621552,MEX:55042078,NZL:33082395,PER:102262801},FRA:{USA:237880615,CHN:205638399,JPN:10357273,NOR:763531454,ESP:256443913,SWE:35297439,DEU:82703106,CAN:68604012,THA:70703567,ITA:32621302,RUS:44090650,GBR:523910488,NLD:199158145,DNK:165671306,CHL:70541859,BEL:75610481,PRT:30752380,POL:140002129,IDN:42288002,IND:101664047,ISL:97154776,ARG:99673181,ECU:152396659,NGA:21452837,BRA:26821017,GRC:70543184,NZL:22566237,PER:93903382},SWE:{CHN:52709183,NOR:2603020946,DEU:15677882,THA:14053120,NLD:25096716,DNK:127057419},DEU:{USA:201558985,CHN:505039491,NOR:630595201,ESP:41600621,FRA:56056175,SWE:27402091,CAN:18045926,THA:52480376,ITA:38712425,RUS:85503850,GBR:80581993,NLD:288997131,DNK:395766318,CHL:32623366,BEL:48822436,POL:450521480,IDN:15531340,IND:28366589,ISL:84850694,ARG:17822024,ECU:13787824,GRC:27757153,NZL:17537179,PER:13133343},CAN:{USA:666512883,CHN:292720962,JPN:14941638,NOR:36430734,THA:126391856,RUS:19374847,CHL:85697025,IND:44954117,ISL:14661983,ECU:19691343,NZL:10288474},THA:{USA:207865168,CHN:61871906,JPN:159199573,NOR:91606731,ESP:30493128,FRA:10404560,CAN:24187606,RUS:20518988,KOR:121312911,CHL:64450584,IDN:139701735,IND:93730240,AUS:11724236,MYS:29330606,NZL:14256259,PER:10519823},ITA:{USA:77297046,CHN:84854687,ESP:776845891,FRA:341521360,SWE:123449846,DEU:116676513,CAN:17450307,THA:146656773,GBR:143514766,KOR:35710515,NLD:369648162,DNK:347021634,CHL:16986438,BEL:20673095,PRT:33863408,POL:30788472,IDN:40887957,IND:105174411,ARG:161607201,ECU:138225876,GRC:279212959,MEX:31210090,SGP:15219588,PER:18664034},RUS:{USA:53418496,CHN:192219272,JPN:58706721,NOR:885854517,ESP:33719579,FRA:11116228,CAN:91428885,THA:26101633,GBR:81294611,DNK:62728854,CHL:77002281,IDN:20528942,IND:20965781,ISL:101207457,ARG:19179915,GRC:15235020,NZL:10172801},GBR:{USA:52230640,CHN:194167580,NOR:150762982,ESP:24007303,FRA:41699485,SWE:118385219,DEU:103304580,CAN:33335055,THA:70442285,RUS:74387401,NLD:103469431,DNK:142527290,POL:37296938,IDN:54314128,IND:77267671,ISL:396137056,ECU:18428223,GRC:31162325,SGP:11049816},KOR:{USA:110672205,CHN:944106511,JPN:212210920,NOR:95186886,CAN:40295885,THA:77100391,RUS:493030717,HKG:54322491,CHL:34116397,IDN:45851932,IND:17228134,MYS:44143062,ARG:21234187,PER:16887272},NLD:{USA:62007538,CHN:95696652,JPN:17691060,NOR:129080839,ESP:10473574,FRA:46865931,SWE:24840932,DEU:262430655,THA:11615062,ITA:15808469,RUS:70084122,GBR:116960660,DNK:96364840,BEL:122442714,POL:11853700,IDN:14735922,IND:54900091,ISL:160475047,ECU:11177558,NGA:25356656,PER:13300114},DNK:{USA:39102451,CHN:45061093,NOR:376391537,FRA:13769558,SWE:96548586,DEU:67873024,CAN:55316459,GBR:30904536,NLD:27466294,BEL:11149607,POL:58891955},HKG:{USA:172965106,CHN:373457087,JPN:512469165,NOR:125416880,ESP:48067987,FRA:14904200,CAN:116681117,THA:69677302,KOR:28090555,CHL:25529153,IDN:126341636,IND:69124409,AUS:228868822,MYS:47149413,ECU:10791796,BRA:33697835,MEX:27313466,SGP:48925718,NZL:86021244,PER:12095094},CHL:{ECU:14928026},BEL:{USA:37216435,CHN:61484475,FRA:142052457,SWE:49335033,DEU:58498355,CAN:39751389,THA:37789109,GBR:68467558,NLD:338238323,DNK:81682148,POL:16759688,IDN:22743657,IND:61087623,ISL:79321716,ECU:29761717,NGA:10528228},PRT:{USA:52453706,CHN:75938302,ESP:702605458,FRA:36894333,SWE:217937490,DEU:18570168,ITA:16366241,RUS:28812916,GBR:32192843,NLD:101224564,DNK:41689825,IND:35469892,ISL:15550070,GRC:35775240,MEX:15016433},POL:{USA:28494769,CHN:124485982,NOR:670960292,ESP:11165088,SWE:25533766,DEU:71032134,RUS:40208371,GBR:35329047,NLD:29828248,DNK:53449480,CHL:18321355,ISL:45976038,ARG:15259907},IDN:{CHN:83085065,JPN:19332887,THA:27953261,MYS:17231271},ISL:{NOR:15700027,CAN:19892181},AUS:{USA:11314890,CHN:110366244,NOR:18533781,THA:57424672,DNK:16555582,IDN:26398218,MYS:29177817,NZL:153576404},MYS:{CHN:222332987,JPN:18989713,NOR:14551552,THA:97502533,IDN:123838430,IND:29127196},ARG:{CHL:30147945},ECU:{PER:56180865},NGA:{USA:58014746,CHN:103066441,NOR:116375109,RUS:15077980,GBR:12643002,NLD:41696148,CHL:86239823,IND:11956956,ISL:82633350,ARG:16521386},BRA:{CHN:96383993,NOR:216853237,CHL:254200208,PRT:85075611,ARG:162249228},GRC:{CHN:18641091,ESP:61191869,FRA:14927591,SWE:24468043,DEU:17324543,ITA:31371558,NLD:38875619,DNK:18376994,IND:18381126},MEX:{USA:15952430,CHN:119032080,NOR:19425414,CHL:41489666},SGP:{USA:16995031,CHN:28278902,JPN:43438072,NOR:44882847,ESP:13722083,FRA:16856770,THA:32075828,KOR:10086021,HKG:15864464,IDN:114230637,IND:23931710,AUS:23495517,MYS:105314193},NZL:{CHN:14746706,THA:16102160},PER:{CHL:40763261,ECU:10731800},CHE:{USA:18596127,NOR:37162358,FRA:52288214,DEU:29759819,ITA:21875935,GBR:14593210,NLD:61144221,DNK:48403408,POL:15437257},EGY:{CHN:17995149,JPN:37583738,NOR:29236595,ESP:16560046,NLD:77599965,IND:13098538,ARG:10761126}};
var n=d3.keys(nodes).length; // number of nodes
d3.keys(nodes).forEach(function(key,i) {nodes[key].id=i;nodes[key].angle=2*Math.PI*i/n;})

var w=700,h=600;

var cx=320,cy=250,r=200,dist=35;

var svg=d3.select("#chart").append("svg").attr("width",w).attr("height",h);

svg.append("defs").append("linearGradient").attr("id","strokeG").selectAll("stop").data(["#ffcc00","#0099cc"]).enter()
	.append("stop")
	.attr("offset",function(d,i) {return i?"100%":"0%";})
	.style("stop-color",String)

var rScale=d3.scale.linear().domain([0,32000000000]).range([0,30]);
var lScale=d3.scale.linear().domain([0,3200000000]).range([0,40]);
var cScale=d3.scale.linear().domain([0,3200000000]).range(["#fff","#0099cc"]);

var selection={};
var lastSelected=-1;

var mode=0;

svg
	.append("g").classed("links",1).selectAll(".links").data(d3.keys(links)).enter()
		.append("g").classed("gradient",1)
		.selectAll(".links").data(
			function(key) {
				return d3.keys(links[key]).map(function(d) {return [key,d];})
			}).enter()
				.append("path")
				.attr("d",myPath)
				.attr("class",function(d) {return "link "+d[0]+" "+d[1];})
				.style("stroke-opacity",.5).style("stroke","url(#strokeG)")
				.style("fill","none")
				.style("stroke-width",function(d) {return lScale(links[d[0]][d[1]]);})
					.append("title")
					.text(linkTitle);

svg
	.append("g").classed("links",1).selectAll(".links").data(d3.keys(links)).enter()
		.append("g").classed("solid",1)
		.selectAll(".links").data(
			function(key) {
				return d3.keys(links[key]).map(function(d) {return [key,d];})
			}).enter()
				.append("path")
				.attr("d",myPath)
				.attr("class",function(d) {return "link "+d[0]+" "+d[1];})
				.style("stroke",function(d) {return cScale(links[d[0]][d[1]]);})
				.style("fill","none")
				.style("stroke-opacity",0).style("visibility","hidden")
				.style("stroke-width",function(d) {return lScale(links[d[0]][d[1]]);})
					.append("title")
					.text(linkTitle);


circlesX=svg
	.append("g")
	.classed("circlesX",1)
;
circlesY=svg
	.append("g")
	.classed("circlesY",1)
;

squaresX=svg
	.append("g")
	.classed("squaresX",1).style("visibility","hidden")
		.style("opacity",0);

squaresY=svg
	.append("g")
	.classed("squaresX",1).style("visibility","hidden")
		.style("opacity",0);

squares=svg
	.append("g")
	.classed("squares",1).style("visibility","hidden")
		.style("opacity",0);

circles=svg.selectAll(".nodes").data(d3.keys(nodes)).enter()
	.append("g").classed("circles",1)
	.attr("transform", translate)
	.on("click",function(d) {
		if (lastSelected==d) {lastSelected=-1;}
		if (d in selection) {
			delete selection[d];
			d3.select(".n"+d).style("fill","#eee").style("stroke","none");
			d3.select(".t"+d).style("fill","black");
			} else {
			selection[d]=true;lastSelected=d;
			d3.select(".n"+d).style("fill","#ccc").style("stroke","#888");
			d3.select(".t"+d).style("fill","#008");
		}

		if (!d3.keys(selection).length) {d3.selectAll(".link").style("visibility","visible");}
		else {
			d3.selectAll(".link").style("visibility","hidden");
			d3.keys(selection).forEach(function(key) {d3.selectAll("."+key).style("visibility","visible");})
		}
	});

circles
		.append("circle")
		.attr("r",rNode)
		.style("opacity",.8)
		.attr("class",function(d) {return "n"+d;})
		.style("fill",function(d) {return ((d in selection)?"#888":"#eee");})


circlesX
	.selectAll("circle").data(d3.keys(nodes)).enter()
		.append("circle")
		.attr("cx",xNode)
		.attr("cy",yNode)
		.attr("r",function(d) {return rScale(nodes[d].exports);})
		.style("fill","#ffcc00")
		.style("visibility","hidden")
		.style("opacity",0)
;


circlesY
	.selectAll("circle").data(d3.keys(nodes)).enter()
		.append("circle")
		.attr("cx",xNode)
		.attr("cy",yNode)
		.attr("r",function(d) {return rScale(nodes[d].imports);})
		.style("fill","#0099cc")
		.style("visibility","hidden")
		.style("opacity",0)
;

circles.append("title").text(function(key) {return nodes[key].name;})
circles.append("text")
	.attr("class",function(d) {return "t"+d;})
	.text(function(key) {return nodes[key].name;})
	.attr("dx",function(d) {return dist*Math.cos(Math.PI/2-nodes[d].angle);})
	.attr("dy",function(d) {return -dist*Math.sin(Math.PI/2-nodes[d].angle);})
	.attr("text-anchor",function(key) {return (nodes[key].id>n/2)?"end":"start"})



squaresX
	.selectAll("rect").data(d3.keys(nodes)).enter()
		.append("rect")
		.attr("x",function(d,i) {return 22+i*15;})
		.attr("y",0)
		.attr("width",15)
		.attr("height",25)
		.style("fill",function(d) {return ((d in selection)?"#888":"#fff");});
squaresX
	.selectAll("text").data(d3.keys(nodes)).enter()
		.append("text")
		.text(String)
		.attr("text-anchor","end")
		.attr("transform",function(d,i) {return "rotate(-90) translate(-1,"+(37+i*15)+")";})
;


squaresY
	.selectAll("rect").data(d3.keys(nodes)).enter()
		.append("rect")
		.attr("y",function(d,i) {return 25+i*15;})
		.attr("x",0)
		.attr("width",22)
		.attr("height",15)
		.style("fill",function(d) {return ((d in selection)?"#888":"#fff");});
squaresY
	.selectAll("text").data(d3.keys(nodes)).enter()
		.append("text")
		.text(String)
		.attr("dy",8)
		.attr("y",function(d,i) {return 27+i*15;})
		.attr("x",1);



function xNode(key) {return cx+(r)*Math.cos((Math.PI/2)-nodes[key].angle);}
function yNode(key) {return cy-(r)*Math.sin((Math.PI/2)-nodes[key].angle);}
function rNode(key) {return rScale(nodes[key].trade);}
function translate(key) {return "translate("+xNode(key)+","+yNode(key)+")";}

function myPath(pair) {
	if(typeof(pair) !== 'undefined'){
		var source=pair[0];
		var target=pair[1];
		return "M "+xNode(source)+" "+yNode(source)+" Q "+(h/2)+" "+(h/2)+", "+xNode(target)+" "+yNode(target);
	} else {return "M0 0";}
}

function squarePath(pair) {
	if(typeof(pair) !== 'undefined'){
		var source=pair[0], i = d3.keys(nodes).indexOf(source);
		var target=pair[1], j = d3.keys(nodes).indexOf(target);
		function x(i) {return 22+i*15;}
		function y(j) {return 25+j*15;}
	//	var path="M "+x(i)+" "+y(j)+" h 15 v 15 h -15 v -15";return path;
		return "M "+x(i)+" "+(y(j)+7)+" Q "+(x(i)+7)+" "+(y(j)+7)+" "+(x(i)+15)+" "+(y(j)+7);
	}
	else {return "M0 0";}
}

function linkTitle(pair) {
	var source=pair[0];
	var target=pair[1];
	var title=nodes[source].name+"/"+nodes[target].name+"</br>"
	if(source in links){if (target in links[source]){title+=target+" to "+source+": USD "+~~(links[source][target]/1000000)+"m</br>";}}
	if(target in links){if (source in links[target]){title+=source+" to "+target+": USD "+~~(links[target][source]/1000000)+"m";}}
	return title;
}

function changeMode() {var duration=1000;
	if(modeT) {transMode();return true;}
	if(mode) { // going from squares to circles
		squaresX.transition().duration(duration).style("opacity",0).each("end",function() {d3.select(this).style("visibility","hidden");});
		squaresY.transition().duration(duration).style("opacity",0).each("end",function() {d3.select(this).style("visibility","hidden");});
		squares .transition().duration(duration).style("opacity",0).each("end",function() {d3.select(this).style("visibility","hidden");});

		circlesX.selectAll("circle").style("opacity",.5).style("visibility","visible")
			.transition()
			.duration(duration)
			.attr("cx",xNode)
			.attr("cy",yNode)
			.each("end",function() {d3.select(this).style("visibility","hidden").style("opacity",0);});
		circlesY.selectAll("circle").style("opacity",.5).style("visibility","visible")
			.transition()
			.duration(duration)
			.attr("cx",xNode)
			.attr("cy",yNode)
			.each("end",function() {d3.select(this).style("visibility","hidden").style("opacity",0);});
		circles.selectAll("circle").style("visibility","visible").transition()
			.delay(duration)
			.style("opacity",.8);
		circles.selectAll("text").style("visibility","visible").transition()
			.delay(duration)
			.style("opacity",1);

		svg.select(".links").selectAll("path").style("visibility","visible").transition()
			.delay(duration)
			.style("stroke-opacity",.5);


	} else { // going from circles to square
		circles.selectAll("circle").transition().duration(duration).style("opacity",0).each("end",function() {d3.select(this).style("visibility","hidden");});
		circles.selectAll("text").transition().duration(duration).style("opacity",0).each("end",function() {d3.select(this).style("visibility","hidden");});
		svg.select(".links").selectAll("path").transition().duration(duration).style("stroke-opacity",0).each("end",function() {d3.select(this).style("visibility","hidden");});
		circlesX.selectAll("circle").style("opacity",.5).style("visibility","visible")
			.transition()
			.duration(duration)
			.attr("cx",function(d,i) {return 22*i+15;})
			.attr("cy",11)
			.each("end",function() {d3.select(this).style("visibility","hidden").style("opacity",0);});
		circlesY.selectAll("circle").style("opacity",.5).style("visibility","visible")
			.transition()
			.duration(duration)
			.attr("cx",11)
			.attr("cy",function(d,i) {return 25*i+15;})
			.each("end",function() {d3.select(this).style("visibility","hidden").style("opacity",0);});
		squaresX.style("visibility","visible").transition()
			.delay(duration)
			.style("opacity",1);
		squaresY.style("visibility","visible").transition()
			.delay(duration)
			.style("opacity",1);
		squares .style("visibility","visible").transition()
			.delay(duration)
			.style("opacity",1);
	};
	mode=1-mode;
}
var modeT=0;

function transMode() {var duration=2000;
	var delay=0;
	if (mode) {changeMode();return true;}
	else if(modeT) {
		squaresX.transition().duration(duration).style("opacity",0).each("end",function() {d3.select(this).style("visibility","hidden");});
		squaresY.transition().duration(duration).style("opacity",0).each("end",function() {d3.select(this).style("visibility","hidden");});
		circlesX.selectAll("circle").style("opacity",.5).style("visibility","visible")
			.transition()
			.duration(duration)
			.attr("cx",xNode)
			.attr("cy",yNode)
			.each("end",function() {d3.select(this).style("visibility","hidden").style("opacity",0);});
		circlesY.selectAll("circle").style("opacity",.5).style("visibility","visible")
			.transition()
			.duration(duration)
			.attr("cx",xNode)
			.attr("cy",yNode)
			.each("end",function() {d3.select(this).style("visibility","hidden").style("opacity",0);});
		circles.selectAll("circle").style("visibility","visible").transition()
			.delay(duration)
			.style("opacity",.8);
		circles.selectAll("text").style("visibility","visible").transition()
			.delay(duration)
			.style("opacity",1);

		svg.selectAll(".solid").selectAll("path")
			.transition()
			.duration(duration)
			.attr("d",myPath)
			.style("stroke-width",function(d) {return lScale(links[d[0]][d[1]]);})
			.style("opacity",0)
			.each("end",function() {d3.select(this).style("visibility","hidden");});
		svg.selectAll(".gradient").selectAll("path").style("visibility","visible")
			.transition()
			.duration(duration)
			.attr("d",myPath)
			.style("stroke-width",function(d) {return lScale(links[d[0]][d[1]]);})
			.style("opacity",1);
	} else {
		circles.selectAll("circle").transition().duration(duration).style("opacity",0).each("end",function() {d3.select(this).style("visibility","hidden");});
		circles.selectAll("text").transition().duration(duration).style("opacity",0).each("end",function() {d3.select(this).style("visibility","hidden");});
		circlesX.selectAll("circle").style("opacity",.5).style("visibility","visible")
			.transition()
			.duration(duration)
			.attr("cx",function(d,i) {return 22+i*15;})
			.attr("cy",11)
			.each("end",function() {d3.select(this).style("visibility","hidden").style("opacity",0);});
		circlesY.selectAll("circle").style("opacity",.5).style("visibility","visible")
			.transition()
			.duration(duration)
			.attr("cx",11)
			.attr("cy",function(d,i) {return 25+i*15;})
			.each("end",function() {d3.select(this).style("visibility","hidden").style("opacity",0);});
		squaresX.style("visibility","visible").transition()
			.delay(duration)
			.style("opacity",1);
		squaresY.style("visibility","visible").transition()
			.delay(duration)
			.style("opacity",1);
		svg.selectAll(".gradient").selectAll("path")
			.transition()
			.duration(duration)
			.attr("d",squarePath)
			.style("stroke-width",15)
			.style("opacity",0)
			.each("end",function() {d3.select(this).style("visibility","hidden");});
		svg.selectAll(".solid").selectAll("path").style("visibility","visible")
			.transition()
			.duration(duration)
			.attr("d",squarePath)
			.style("stroke-width",15)
			.style("stroke-opacity",1)
			.style("opacity",1)
			;
	};
	modeT=1-modeT;
}





$('path').tipsy({html: true, gravity: 's'});

</script>
</body>
</html>